import { generateMatrix } from './matrix'
import { simpleString } from './fixtures'
import { FINDER_PATTERN, FINDER_PATTERN_OUTER_SIZE } from './finderPattern'
import { Matrix } from './types'

const asciiRender = (matrix: Matrix) => {
  const ASCII = new Map<0 | 1 | null, string>([
    [0, '░'],
    [1, '▓'],
    [null, '·'],
  ])

  return (
    '\n' +
    matrix.map(row => row.map(pixel => ASCII.get(pixel)).join(' ')).join('\n')
  )
}

describe('renderer > matrix > generateMatrix', () => {
  const simpleStringMatrix = generateMatrix(simpleString)

  it('adds top left finder pattern', () => {
    const finderPatternArea = simpleStringMatrix
      .slice(0, FINDER_PATTERN_OUTER_SIZE)
      .map(row => row.slice(0, FINDER_PATTERN_OUTER_SIZE))

    expect(finderPatternArea).toEqual(FINDER_PATTERN)
  })

  it('adds the timing patterns', () => {
    const column6 = simpleStringMatrix[6].join('')

    expect(column6).toEqual('111111101010101111111')

    const row6 = simpleStringMatrix.map(column => column[6]).join('')

    expect(row6).toEqual('111111101010101111111')
  })

  it('renders correct QR code', () => {
    expect(asciiRender(simpleStringMatrix)).toMatchInlineSnapshot(`
      "
      ▓ ▓ ▓ ▓ ▓ ▓ ▓ ░ · · · · · ░ ▓ ▓ ▓ ▓ ▓ ▓ ▓
      ▓ ░ ░ ░ ░ ░ ▓ ░ · · · · · ░ ▓ ░ ░ ░ ░ ░ ▓
      ▓ ░ ▓ ▓ ▓ ░ ▓ ░ · · · · · ░ ▓ ░ ▓ ▓ ▓ ░ ▓
      ▓ ░ ▓ ▓ ▓ ░ ▓ ░ · · · · · ░ ▓ ░ ▓ ▓ ▓ ░ ▓
      ▓ ░ ▓ ▓ ▓ ░ ▓ ░ · · · · · ░ ▓ ░ ▓ ▓ ▓ ░ ▓
      ▓ ░ ░ ░ ░ ░ ▓ ░ · · · · · ░ ▓ ░ ░ ░ ░ ░ ▓
      ▓ ▓ ▓ ▓ ▓ ▓ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ▓ ▓ ▓ ▓ ▓ ▓
      ░ ░ ░ ░ ░ ░ ░ ░ · · · · · ░ ░ ░ ░ ░ ░ ░ ░
      · · · · · · ▓ · · · · · · · · · · · · · ·
      · · · · · · ░ · · · · · · · · · · · · · ·
      · · · · · · ▓ · · · · · · · · · · · · · ·
      · · · · · · ░ · · · · · · · · · · · · · ·
      · · · · · · ▓ · · · · · · · · · · · · · ·
      ░ ░ ░ ░ ░ ░ ░ ░ ▓ · · · · · · · · · · · ·
      ▓ ▓ ▓ ▓ ▓ ▓ ▓ ░ · · · · · · · · · · · · ·
      ▓ ░ ░ ░ ░ ░ ▓ ░ · · · · · · · · · · · · ·
      ▓ ░ ▓ ▓ ▓ ░ ▓ ░ · · · · · · · · · · · · ·
      ▓ ░ ▓ ▓ ▓ ░ ▓ ░ · · · · · · · · · · · · ·
      ▓ ░ ▓ ▓ ▓ ░ ▓ ░ · · · · · · · · · · · · ·
      ▓ ░ ░ ░ ░ ░ ▓ ░ · · · · · · · · · · · · ·
      ▓ ▓ ▓ ▓ ▓ ▓ ▓ ░ · · · · · · · · · · · · ·"
    `)
  })

  it('renders v7 matrix', () => {
    expect(asciiRender(generateMatrix({ ...simpleString, version: 7 })))
      .toMatchInlineSnapshot(`
      "
      ▓ ▓ ▓ ▓ ▓ ▓ ▓ ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ░ ▓ ▓ ▓ ▓ ▓ ▓ ▓
      ▓ ░ ░ ░ ░ ░ ▓ ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ░ ▓ ░ ░ ░ ░ ░ ▓
      ▓ ░ ▓ ▓ ▓ ░ ▓ ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ░ ▓ ░ ▓ ▓ ▓ ░ ▓
      ▓ ░ ▓ ▓ ▓ ░ ▓ ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ░ ▓ ░ ▓ ▓ ▓ ░ ▓
      ▓ ░ ▓ ▓ ▓ ░ ▓ ░ · · · · · · · · · · · · ▓ ▓ ▓ ▓ ▓ · · · · · · · · · · · · ░ ▓ ░ ▓ ▓ ▓ ░ ▓
      ▓ ░ ░ ░ ░ ░ ▓ ░ · · · · · · · · · · · · ▓ ░ ░ ░ ▓ · · · · · · · · · · · · ░ ▓ ░ ░ ░ ░ ░ ▓
      ▓ ▓ ▓ ▓ ▓ ▓ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ░ ▓ ▓ ▓ ▓ ▓ ▓ ▓
      ░ ░ ░ ░ ░ ░ ░ ░ · · · · · · · · · · · · ▓ ░ ░ ░ ▓ · · · · · · · · · · · · ░ ░ ░ ░ ░ ░ ░ ░
      · · · · · · ▓ · · · · · · · · · · · · · ▓ ▓ ▓ ▓ ▓ · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ▓ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ▓ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ▓ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ▓ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ▓ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · ▓ ▓ ▓ ▓ ▓ · · · · · · · · · · · ▓ ▓ ▓ ▓ ▓ · · · · · · · · · · · ▓ ▓ ▓ ▓ ▓ · · · ·
      · · · · ▓ ░ ░ ░ ▓ · · · · · · · · · · · ▓ ░ ░ ░ ▓ · · · · · · · · · · · ▓ ░ ░ ░ ▓ · · · ·
      · · · · ▓ ░ ▓ ░ ▓ · · · · · · · · · · · ▓ ░ ▓ ░ ▓ · · · · · · · · · · · ▓ ░ ▓ ░ ▓ · · · ·
      · · · · ▓ ░ ░ ░ ▓ · · · · · · · · · · · ▓ ░ ░ ░ ▓ · · · · · · · · · · · ▓ ░ ░ ░ ▓ · · · ·
      · · · · ▓ ▓ ▓ ▓ ▓ · · · · · · · · · · · ▓ ▓ ▓ ▓ ▓ · · · · · · · · · · · ▓ ▓ ▓ ▓ ▓ · · · ·
      · · · · · · ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ▓ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ▓ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ▓ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ▓ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ▓ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      · · · · · · ▓ · · · · · · · · · · · · · ▓ ▓ ▓ ▓ ▓ · · · · · · · · · · · ▓ ▓ ▓ ▓ ▓ · · · ·
      ░ ░ ░ ░ ░ ░ ░ ░ ▓ · · · · · · · · · · · ▓ ░ ░ ░ ▓ · · · · · · · · · · · ▓ ░ ░ ░ ▓ · · · ·
      ▓ ▓ ▓ ▓ ▓ ▓ ▓ ░ · · · · · · · · · · · · ▓ ░ ▓ ░ ▓ · · · · · · · · · · · ▓ ░ ▓ ░ ▓ · · · ·
      ▓ ░ ░ ░ ░ ░ ▓ ░ · · · · · · · · · · · · ▓ ░ ░ ░ ▓ · · · · · · · · · · · ▓ ░ ░ ░ ▓ · · · ·
      ▓ ░ ▓ ▓ ▓ ░ ▓ ░ · · · · · · · · · · · · ▓ ▓ ▓ ▓ ▓ · · · · · · · · · · · ▓ ▓ ▓ ▓ ▓ · · · ·
      ▓ ░ ▓ ▓ ▓ ░ ▓ ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      ▓ ░ ▓ ▓ ▓ ░ ▓ ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      ▓ ░ ░ ░ ░ ░ ▓ ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·
      ▓ ▓ ▓ ▓ ▓ ▓ ▓ ░ · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·"
    `)
  })
})
